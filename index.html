<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão Financeira</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            font-family: 'Arial', sans-serif;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background-color: white;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .card {
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: scale(1.02);
        }

        h1, h2 {
            color: #333;
        }

        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        .btn-delete {
            background-color: red;
            border: none;
            color: white;
            padding: 5px 10px;
            margin-top: 10px;
            cursor: pointer;
        }

        .confirm-box {
            display: none;
        }

        .list-group-item.confirming .confirm-box {
            display: block;
        }

        .list-group-item.confirming .btn-delete {
            display: none;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .btn-block {
            display: block;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Sistema de Gestão Financeira</h1>

        <div class="card">
            <div class="card-body">
                <h2>Receitas</h2>
                <div class="form-group">
                    <select class="form-control" id="incomeType">
                        <option value="salario">Salário</option>
                        <option value="rendaExtra">Renda Extra</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="number" class="form-control" id="incomeValue" placeholder="Valor (em Mt)">
                </div>
                <button class="btn btn-primary btn-block" onclick="addIncome()">Adicionar</button>
               
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h2>Despesas</h2>
                <div class="form-group">
                    <input type="text" class="form-control" id="expenseName" placeholder="Nome da Despesa">
                </div>
                <div class="form-group">
                    <input type="number" class="form-control" id="expenseValue" placeholder="Valor (em Mt)">
                </div>
                <button class="btn btn-primary btn-block" onclick="addExpense()">Adicionar</button>
                
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h2>Dívidas</h2>
                <div class="form-group">
                    <input type="text" class="form-control" id="clientName" placeholder="Nome do Cliente">
                </div>
                <div class="form-group">
                    <select class="form-control" id="debtType">
                        <option value="normal">Dívida Normal</option>
                        <option value="emprestimo">Dívida com Empréstimo</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="number" class="form-control" id="debtValue" placeholder="Valor (em Mt)">
                </div>
                <div id="interestRates" class="form-group" style="display:none;">
                    <label for="interestRate">Taxa de Juros:</label>
                    <select class="form-control" id="interestRate">
                        <option value="20">20%</option>
                        <option value="25">25%</option>
                        <option value="30">30%</option>
                        <option value="35">35%</option>
                        <option value="40">40%</option>
                    </select>
                </div>
                <button class="btn btn-primary btn-block" onclick="addDebt()">Adicionar</button>

            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h2>Reembolsos</h2>
                <div class="form-group">
                    <select class="form-control" id="reimbursementClient"></select>
                </div>
                <div class="form-group">
                    <input type="number" class="form-control" id="reimbursementValue" placeholder="Valor Reembolsado (em Mt)">
                </div>
                <button class="btn btn-primary btn-block" onclick="addReimbursement()">Adicionar
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h2>Resumo</h2>
                <p>Total de Juros: <span id="totalInterest">0 Mt</span></p>
                <p>Total de Clientes Ativos: <span id="totalClients">0</span></p>
                <p>Total de Receitas: <span id="totalIncome">0 Mt</span></p>
                <p>Total de Dívidas Normais: <span id="totalNormalDebts">0 Mt</span></p>
                <p>Total de Dívidas com Empréstimo: <span id="totalLoanDebts">0 Mt</span></p>
                <p>Saldo Disponível: <span id="availableBalance">0 Mt</span></p>
                <button class="btn btn-danger btn-block" onclick="promptPassword()">Limpar Todo o Histórico</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h2>Clientes e Dívidas</h2>
                <ul id="clientDebtList" class="list-group"></ul>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
  apiKey: "AIzaSyD8XOHaLCzNLDrIlHG3em4g4gyYIKTLWpQ",
  authDomain: "xitique-61310.firebaseapp.com",
  databaseURL: "https://xitique-61310-default-rtdb.firebaseio.com",
  projectId: "xitique-61310",
  storageBucket: "xitique-61310.appspot.com",
  messagingSenderId: "331274991404",
  appId: "1:331274991404:web:2fec0eb082d3fe0b33de89",
  measurementId: "G-DFDMBKW1RK"
};

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database();

        // Validar Entrada
        function validateInput(value, errorMsg) {
            if (isNaN(value) || value <= 0) {
                alert(errorMsg);
                return false;
            }
            return true;
        }

        // Adicionar Receita
        function addIncome() {
            var incomeType = document.getElementById('incomeType').value;
            var incomeValue = parseFloat(document.getElementById('incomeValue').value);

            if (!validateInput(incomeValue, 'Por favor, insira um valor válido para a receita.')) return;

            var newIncomeKey = database.ref().child('incomes').push().key;
            database.ref('incomes/' + newIncomeKey).set({
                type: incomeType,
                value: incomeValue,
                date: new Date().toISOString()
            });
            document.getElementById('incomeType').value = 'salario';
            document.getElementById('incomeValue').value = '';
            updateSummary();
        }

        // Adicionar Despesa
        function addExpense() {
            var expenseName = document.getElementById('expenseName').value;
            var expenseValue = parseFloat(document.getElementById('expenseValue').value);

            if (expenseName === '' || !validateInput(expenseValue, 'Por favor, insira um valor válido para a despesa.')) return;

            var newExpenseKey = database.ref().child('expenses').push().key;
            database.ref('expenses/' + newExpenseKey).set({
                name: expenseName,
                value: expenseValue,
                date: new Date().toISOString()
            });
            document.getElementById('expenseName').value = '';
            document.getElementById('expenseValue').value = '';
            updateSummary();
        }

        // Mostrar/Ocultar Taxa de Juros
        document.getElementById('debtType').addEventListener('change', function () {
            var interestRates = document.getElementById('interestRates');
            if (this.value === 'emprestimo') {
                interestRates.style.display = 'block';
            } else {
                interestRates.style.display = 'none';
            }
        });

        // Adicionar Dívida
        function addDebt() {
            var clientName = document.getElementById('clientName').value;
            var debtType = document.getElementById('debtType').value;
            var debtValue = parseFloat(document.getElementById('debtValue').value);

            if (clientName === '' || !validateInput(debtValue, 'Por favor, insira um valor válido para a dívida.')) return;

            var interestRate = debtType === 'emprestimo' ? parseFloat(document.getElementById('interestRate').value) : 0;
            var totalToPay = debtValue + (debtValue * interestRate / 100);
            var newDebtKey = database.ref().child('debts').push().key;
            database.ref('debts/' + newDebtKey).set({
                clientName: clientName,
                type: debtType,
                value: debtValue,
                interestRate: interestRate,
                totalToPay: totalToPay,
                date: new Date().toISOString()
            });
            document.getElementById('clientName').value = '';
            document.getElementById('debtType').value = 'normal';
            document.getElementById('debtValue').value = '';
            document.getElementById('interestRates').style.display = 'none';
            updateSummary();
        }

        // Adicionar Reembolso
        function addReimbursement() {
            var reimbursementClient = document.getElementById('reimbursementClient').value;
            var reimbursementValue = parseFloat(document.getElementById('reimbursementValue').value);

            if (reimbursementClient === '' || !validateInput(reimbursementValue, 'Por favor, insira um valor válido para o reembolso.')) return;

            var newReimbursementKey = database.ref().child('reimbursements').push().key;
            database.ref('reimbursements/' + newReimbursementKey).set({
                client: reimbursementClient,
                value: reimbursementValue,
                date: new Date().toISOString()
            });
            document.getElementById('reimbursementClient').value = '';
            document.getElementById('reimbursementValue').value = '';
            updateSummary();
        }

        // Atualizar Resumo
        function updateSummary() {
            database.ref().once('value', function(snapshot) {
                var incomes = snapshot.val().incomes || {};
                var expenses = snapshot.val().expenses || {};
                var debts = snapshot.val().debts || {};
                var reimbursements = snapshot.val().reimbursements || {};

                var totalIncome = 0;
                for (var key in incomes) {
                    totalIncome += incomes[key].value;
                }

                var totalExpenses = 0;
                for (var key in expenses) {
                    totalExpenses += expenses[key].value;
                }

                var totalNormalDebts = 0;
                var totalLoanDebts = 0;
                var totalInterest = 0;
                var activeClients = {};
                for (var key in debts) {
                    var debt = debts[key];
                    if (debt.type === 'normal') {
                        totalNormalDebts += debt.value;
                    } else {
                        totalLoanDebts += debt.value;
                        totalInterest += debt.value * debt.interestRate / 100;
                    }
                    activeClients[debt.clientName] = true;
                }

                var totalReimbursements = 0;
                for (var key in reimbursements) {
                    totalReimbursements += reimbursements[key].value;
                }

                var availableBalance = totalIncome - totalExpenses - totalNormalDebts - totalLoanDebts + totalReimbursements;

                document.getElementById('totalIncome').innerText = totalIncome + ' Mt';
                document.getElementById('totalNormalDebts').innerText = totalNormalDebts + ' Mt';
                document.getElementById('totalLoanDebts').innerText = totalLoanDebts + ' Mt';
                document.getElementById('totalInterest').innerText = totalInterest + ' Mt';
                document.getElementById('totalClients').innerText = Object.keys(activeClients).length;
                document.getElementById('availableBalance').innerText = availableBalance + ' Mt';

                updateClientDebtList(debts);
            });
        }

        // Atualizar Lista de Dívidas de Clientes
        function updateClientDebtList(debts) {
            var clientDebtList = document.getElementById('clientDebtList');
            clientDebtList.innerHTML = '';
            for (var key in debts) {
                var debt = debts[key];
                var listItem = document.createElement('li');
                listItem.className = 'list-group-item';
                listItem.innerHTML = `
                    <strong>Cliente:</strong> ${debt.clientName}<br>
                    <strong>Valor Devido:</strong> ${debt.value} Mt<br>
                    <strong>Juros:</strong> ${debt.interestRate}%<br>
                    <strong>Total a Pagar:</strong> ${debt.totalToPay} Mt<br>
                    <strong>Data:</strong> ${new Date(debt.date).toLocaleString()}<br>
                    <button class="btn-delete" onclick="confirmDelete('${key}')">Excluir</button>
                    <div class="confirm-box">
                        <button class="btn-confirm" onclick="deleteDebt('${key}')">Sim</button>
                        <button class="btn-delete" onclick="cancelDelete('${key}')">Não</button>
                    </div>
                `;
                clientDebtList.appendChild(listItem);
            }
            updateReimbursementClients();
        }

        // Atualizar Lista de Clientes para Reembolsos
        function updateReimbursementClients() {
            var reimbursementClientSelect = document.getElementById('reimbursementClient');
            reimbursementClientSelect.innerHTML = '';
            database.ref('debts').once('value', function(snapshot) {
                var debts = snapshot.val() || {};
                var clientNames = [];
                for (var key in debts) {
                    var debt = debts[key];
                    if (!clientNames.includes(debt.clientName)) {
                        clientNames.push(debt.clientName);
                    }
                }
                clientNames.forEach(function(clientName) {
                    var option = document.createElement('option');
                    option.value = clientName;
                    option.innerText = clientName;
                    reimbursementClientSelect.appendChild(option);
                });
            });
        }

        // Confirmar Exclusão
        function confirmDelete(key) {
            var listItem = document.querySelector(`button[onclick="confirmDelete('${key}')"]`).parentElement;
            listItem.classList.add('confirming');
        }

        // Cancelar Exclusão
        function cancelDelete(key) {
            var listItem = document.querySelector(`button[onclick="confirmDelete('${key}')"]`).parentElement;
            listItem.classList.remove('confirming');
        }

        // Excluir Dívida
        function deleteDebt(key) {
            database.ref('debts/' + key).remove().then(updateSummary);
        }

        // Limpar Dados Específicos
        function confirmClear(type) {
            var confirmation = confirm('Você tem certeza que deseja excluir todos os itens desta seção?');
            if (confirmation) {
                database.ref(type).set(null).then(updateSummary);
            }
        }

        // Limpar Todo o Histórico
        function promptPassword() {
            var password = prompt('Digite a senha para limpar todo o histórico:');
            if (password === '123') {
                clearAllData();
            } else {
                alert('Senha incorreta.');
            }
        }

        function clearAllData() {
            database.ref().set(null).then(updateSummary);
        }

        // Atualizar resumo inicial ao carregar a página
        updateSummary();
    </script>
</body>
</html>
