<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão Financeira</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
       body {
    background-color: #f0f2f5;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    font-family: 'Arial', sans-serif;
    background-image: linear-gradient(to bottom right, #e0e9ec, #f4f9fc);
}

.container {
    width: 100%;
    max-width: 900px;
    background-color: #ffffff;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    padding: 40px;
    border-radius: 20px;
    margin: 50px;
}

.card {
    margin-bottom: 30px;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s ease-out;
    border-radius: 20px;
    overflow: hidden;
}

.card:hover {
    transform: translateY(-10px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

button {
    background-color: #ee0a0a;
    color: white;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    padding: 12px 24px;
    font-size: 18px;
    transition: background-color 0.3s, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    text-transform: uppercase;
    background-image: linear-gradient(to right, #45a049, #4CAF50);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

button:hover {
    background-color: #fa1101;
    transform: scale(1.05);
}

.btn-delete {
    background-color: #dc3545;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 20px;
    font-size: 16px;
    transition: background-color 0.3s, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    text-transform: uppercase;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.btn-delete:hover {
    background-color: #c82333;
    transform: scale(1.05);
}

.list-group-item {
    position: relative;
    padding: 25px;
    margin-bottom: 25px;
    background-color: #ffffff;
    border-radius: 20px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), box-shadow 0.3s ease-out;
}

.list-group-item:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
}

    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Sistema de Gestão Financeira</h1>

        <div class="card">
            <div class="card-body">
                <h2>Receitas</h2>
                <div class="form-group">
                    <select class="form-control" id="incomeType">
                        <option value="salario">Salário</option>
                        <option value="rendaExtra">Renda Extra</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="number" class="form-control" id="incomeValue" placeholder="Valor (em Mt)">
                </div>
                <button class="btn btn-primary btn-block" onclick="addIncome()">Adicionar</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h2>Despesas</h2>
                <div class="form-group">
                    <input type="text" class="form-control" id="expenseName" placeholder="Nome da Despesa">
                </div>
                <div class="form-group">
                    <input type="number" class="form-control" id="expenseValue" placeholder="Valor (em Mt)">
                </div>
                <button class="btn btn-primary btn-block" onclick="addExpense()">Adicionar</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h2>Dívidas</h2>
                <div class="form-group">
                    <input type="text" class="form-control" id="clientName" placeholder="Nome do Cliente">
                </div>
                <div class="form-group">
                    <select class="form-control" id="debtType">
                        <option value="normal">Dívida Normal</option>
                        <option value="emprestimo">Dívida com Empréstimo</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="number" class="form-control" id="debtValue" placeholder="Valor (em Mt)">
                </div>
                <div id="interestRates" class="form-group" style="display:none;">
                    <label for="interestRate">Taxa de Juros:</label>
                    <select class="form-control" id="interestRate">
                        <option value="20">20%</option>
                        <option value="25">25%</option>
                        <option value="30">30%</option>
                        <option value="35">35%</option>
                        <option value="40">40%</option>
                    </select>
                </div>
                <button class="btn btn-primary btn-block" onclick="addDebt()">Adicionar</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h2>Reembolsos</h2>
                <div class="form-group">
                    <select class="form-control" id="reimbursementClient"></select>
                </div>
                <div class="form-group">
                    <input type="number" class="form-control" id="reimbursementValue" placeholder="Valor Reembolsado (em Mt)">
                </div>
                <button class="btn btn-primary btn-block" onclick="addReimbursement()">Adicionar</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h2>Resumo</h2>
                <p>Total de Juros: <span id="totalInterest">0 Mt</span></p>
                <p>Total de Clientes Ativos: <span id="totalClients">0</span></p>
                <p>Total de Receitas: <span id="totalIncome">0 Mt</span></p>
                <p>Total de Dívidas Normais: <span id="totalNormalDebts">0 Mt</span></p>
                <p>Total de Dívidas com Empréstimo: <span id="totalLoanDebts">0 Mt</span></p>
                <p>Saldo Disponível: <span id="availableBalance">0 Mt</span></p>
                <button class="btn btn-danger btn-block" onclick="promptPassword()">Limpar Todo o Histórico</button>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <h2>Clientes e Dívidas</h2>
                <ul id="clientDebtList" class="list-group"></ul>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
    // Configuração do Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyD8XOHaLCzNLDrIlHG3em4g4gyYIKTLWpQ",
        authDomain: "xitique-61310.firebaseapp.com",
        databaseURL: "https://xitique-61310-default-rtdb.firebaseio.com",
        projectId: "xitique-61310",
        storageBucket: "xitique-61310.appspot.com",
        messagingSenderId: "331274991404",
        appId: "1:331274991404:web:2fec0eb082d3fe0b33de89",
        measurementId: "G-DFDMBKW1RK"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    var database = firebase.database();

    // Validar Entrada
    function validateInput(value, errorMsg) {
        if (isNaN(value) || value <= 0) {
            alert(errorMsg);
            return false;
        }
        return true;
    }

    // Função para obter data e hora atual no formato ISO
    function getCurrentDateTime() {
        return new Date().toISOString();
    }

    // Função para calcular a diferença de dias entre duas datas
    function getDifferenceInDays(date1, date2) {
        const diffInMs = Math.abs(new Date(date2) - new Date(date1));
        return diffInMs / (1000 * 60 * 60 * 24);
    }

    // Adicionar Receita
    function addIncome() {
        var incomeType = document.getElementById('incomeType').value;
        var incomeValue = parseFloat(document.getElementById('incomeValue').value);

        if (!validateInput(incomeValue, 'Por favor, insira um valor válido para a receita.')) return;

        var newIncomeKey = database.ref().child('incomes').push().key;
        database.ref('incomes/' + newIncomeKey).set({
            type: incomeType,
            value: incomeValue,
            dateTime: getCurrentDateTime()
        });

        document.getElementById('incomeValue').value = '';
        updateSummary();
    }

    // Adicionar Despesa
    function addExpense() {
        var expenseName = document.getElementById('expenseName').value;
        var expenseValue = parseFloat(document.getElementById('expenseValue').value);

        if (expenseName.trim() === '' || !validateInput(expenseValue, 'Por favor, insira um valor válido para a despesa.')) return;

        var newExpenseKey = database.ref().child('expenses').push().key;
        database.ref('expenses/' + newExpenseKey).set({
            name: expenseName,
            value: expenseValue,
            dateTime: getCurrentDateTime()
        });

        document.getElementById('expenseName').value = '';
        document.getElementById('expenseValue').value = '';
        updateSummary();
    }

    // Adicionar Dívida
    function addDebt() {
        var clientName = document.getElementById('clientName').value;
        var debtType = document.getElementById('debtType').value;
        var debtValue = parseFloat(document.getElementById('debtValue').value);
        var interestRate = parseFloat(document.getElementById('interestRate').value);

        if (clientName.trim() === '' || !validateInput(debtValue, 'Por favor, insira um valor válido para a dívida.')) return;

        var interest = debtType === 'emprestimo' ? interestRate : 0;
        var totalDebtValue = debtType === 'emprestimo' ? debtValue + (debtValue * (interest / 100)) : debtValue;

        var newDebtKey = database.ref().child('debts').push().key;
        database.ref('debts/' + newDebtKey).set({
            client: clientName,
            type: debtType,
            value: debtValue,
            interest: interest,
            remaining: totalDebtValue,
            reimbursed: 0,
            dateTime: getCurrentDateTime()
        });

        // Adiciona cliente se não existir
        var clientRef = database.ref('clients/' + clientName);
        clientRef.once('value', function(snapshot) {
            if (!snapshot.exists()) {
                clientRef.set(true);
            }
        });

        document.getElementById('clientName').value = '';
        document.getElementById('debtValue').value = '';
        document.getElementById('interestRates').style.display = 'none';
        updateSummary();
        updateClientDebtList();
    }

    // Exibir taxas de juros apenas para dívidas com empréstimo
    document.getElementById('debtType').addEventListener('change', function() {
        var debtType = this.value;
        document.getElementById('interestRates').style.display = debtType === 'emprestimo' ? 'block' : 'none';
    });

    // Adicionar Reembolso
    function addReimbursement() {
        var client = document.getElementById('reimbursementClient').value;
        var reimbursementValue = parseFloat(document.getElementById('reimbursementValue').value);

        if (!validateInput(reimbursementValue, 'Por favor, insira um valor válido para o reembolso.')) return;

        database.ref('debts').once('value', function(snapshot) {
            snapshot.forEach(function(debtSnapshot) {
                var debt = debtSnapshot.val();
                if (debt.client === client) {
                    var newReimbursed = (debt.reimbursed || 0) + reimbursementValue;
                    var newRemaining = debt.remaining - reimbursementValue;

                    // Recalcular o remanescente com os juros
                    var remainingAfterReimbursement = newRemaining > 0 ? newRemaining + (newRemaining * (debt.interest / 100)) : 0;
                    database.ref('debts/' + debtSnapshot.key).update({
                        reimbursed: newReimbursed,
                        remaining: remainingAfterReimbursement,
                        dateTime: getCurrentDateTime()
                    });
                }
            });
            updateClientDebtList();
        });

        document.getElementById('reimbursementValue').value = '';
        updateSummary();
    }

    // Função para aplicar juros após 30 dias
    function applyInterestAfter30Days() {
        database.ref('debts').once('value', function(snapshot) {
            snapshot.forEach(function(debtSnapshot) {
                var debt = debtSnapshot.val();
                var daysSinceCreation = getDifferenceInDays(debt.dateTime, new Date());
                if (daysSinceCreation >= 30 && debt.remaining > 0) {
                    var newRemaining = debt.remaining + (debt.remaining * (debt.interest / 100));
                    database.ref('debts/' + debtSnapshot.key).update({
                        remaining: newRemaining,
                        dateTime: getCurrentDateTime()
                    });
                }
            });
            updateSummary();
            updateClientDebtList();
        });
    }

    // Atualizar Resumo
    function updateSummary() {
        database.ref().once('value', function(snapshot) {
            var totalInterest = 0;
            var totalClients = 0;
            var totalIncome = 0;
            var totalNormalDebts = 0;
            var totalLoanDebts = 0;
            var totalReimbursed = 0;

            snapshot.child('debts').forEach(function(debtSnapshot) {
                var debt = debtSnapshot.val();
                totalReimbursed += debt.reimbursed || 0;
                if (debt.type === 'normal') {
                    totalNormalDebts += debt.value;
                } else if (debt.type === 'emprestimo') {
                    totalLoanDebts += debt.value;
                    totalInterest += debt.value * (debt.interest / 100);
                }
            });

            snapshot.child('incomes').forEach(function(incomeSnapshot) {
                totalIncome += incomeSnapshot.val().value;
            });

            var clientSnapshotCount = snapshot.child('clients').numChildren();
            totalClients = clientSnapshotCount === 0 ? 0 : clientSnapshotCount;

            document.getElementById('totalInterest').textContent = totalInterest + ' Mt';
            document.getElementById('totalClients').textContent = totalClients;
            document.getElementById('totalIncome').textContent = totalIncome + ' Mt';
            document.getElementById('totalNormalDebts').textContent = totalNormalDebts + ' Mt';
            document.getElementById('totalLoanDebts').textContent = totalLoanDebts + ' Mt';
            document.getElementById('availableBalance').textContent = (totalIncome - totalNormalDebts - totalLoanDebts + totalReimbursed) + ' Mt';
        });
    }

    // Atualizar Lista de Dívidas de Clientes
    function updateClientDebtList() {
        var clientDebtList = document.getElementById('clientDebtList');
        clientDebtList.innerHTML = '';

        database.ref('debts').once('value', function(snapshot) {
            snapshot.forEach(function(debtSnapshot) {
                var debt = debtSnapshot.val();
                var listItem = document.createElement('li');
                listItem.className = 'list-group-item';
                listItem.setAttribute('data-key', debtSnapshot.key);
                var totalDebtWithInterest = debt.type === 'emprestimo' ? debt.value + (debt.value * (debt.interest / 100)) : debt.value;
                var statusText = debt.remaining <= 0 
                    ? '<span class="badge badge-success">Pago</span>' 
                    : `<span class="badge badge-warning">Pagou ${debt.reimbursed} Mt, Remanescente: ${debt.remaining} Mt (Incluindo Juros)</span>`;
                listItem.innerHTML = `
                    <div>
                        <strong>Cliente:</strong> ${debt.client} <br>
                        <strong>Tipo:</strong> ${debt.type === 'normal' ? 'Dívida Normal' : 'Dívida com Empréstimo'} <br>
                        <strong>Valor:</strong> ${debt.value} Mt <br>
                        ${debt.type === 'emprestimo' ? `<strong>Juros:</strong> ${debt.interest}%` : ''}
                        <br>
                        <strong>Valor Total com Juros:</strong> ${totalDebtWithInterest} Mt <br>
                        <strong>Status:</strong> ${statusText} <br>
                        <strong>Data e Hora:</strong> ${debt.dateTime} <br>
                        <button class="btn btn-danger btn-sm mt-2" onclick="confirmDeleteDebt('${debtSnapshot.key}')">Excluir</button>
                    </div>
                `;
                clientDebtList.appendChild(listItem);
            });
        });

        // Atualizar lista de clientes no campo de reembolso
        var reimbursementClient = document.getElementById('reimbursementClient');
        reimbursementClient.innerHTML = '';

        database.ref('clients').once('value', function(snapshot) {
            snapshot.forEach(function(clientSnapshot) {
                var option = document.createElement('option');
                option.value = clientSnapshot.key;
                option.textContent = clientSnapshot.key;
                reimbursementClient.appendChild(option);
            });
        });
    }

    // Confirmar Exclusão de Dívida
    function confirmDeleteDebt(debtKey) {
        var confirmation = confirm('Tem certeza de que deseja excluir esta dívida?');
        if (confirmation) {
            deleteDebt(debtKey);
        }
    }

    // Excluir Dívida
    function deleteDebt(debtKey) {
        database.ref('debts/' + debtKey).remove();
        updateSummary();
        updateClientDebtList();
    }

    // Limpar Todos os Dados
    function clearAllData() {
    var password = prompt('Digite a senha para limpar todos os dados:');
    if (password === 'suaSenhaSecreta') {
        database.ref().remove()
            .then(function() {
                updateSummary();
                updateClientDebtList();
                alert('Todos os dados foram limpos com sucesso.');
            })
            .catch(function(error) {
                alert('Erro ao limpar os dados: ' + error.message);
            });
    } else {
        alert('Senha incorreta!');
    }
}


    // Inicializar
    updateSummary();
    updateClientDebtList();

    // Verificar juros a cada 24 horas
    setInterval(applyInterestAfter30Days, 24 * 60 * 60 * 1000); // Verificar a cada 24 horas
</script>

</body>
</html>
